<!DOCTYPE html>
<html>
<head>
	<title><%= $title %></title>
	<meta charset="utf-8">
	<style type="text/css">

	body {
		font-family: Sans-Serif;
	}

	iframe {
		border: none;
	}

	div.about {
		margin-top: 2em;
		color: #666666;
	}

	div.about a {
		color: #000066;
		text-decoration: none;
	}

	div.error {
		font-size: 150%;
		font-weight: bold;
		color: #ee0000;
	}

	pre {
		margin-bottom: 2em;
	}

	span.optional,
	span.notes {
		color: #666666;
	}

	div.break {
		height: 1em;
	}

	div.field {
		width: 100%;
		clear: both;
	}

	div.field div.desc {
		float: left;
		width: 14em;
		text-align: right;
		padding-right: 0.5em;
	}

	input, select {
		border: 1px solid black;
	}

	div.notes {
		margin-top: 4em;
	}

	div.notes ul {
		margin-top: 1em;
	}

	</style>
	%= javascript '/jquery-1.10.2.min.js'
</head>
<body>

% if ($city and $stop) {
% if ($errstr) {
<div class="error">Received an error from the backend service:</div>
<div>
<pre>
%= $errstr
</pre>
</div>
% }
% elsif ($frontend eq 'png') {
<img src="/<%= $city %>/<%= $stop %>.png?<%= $params %>" alt=""
id="display" height="<%= $height * 4 %>" width="<%= $width * 4 %>"/>
% }
% elsif ($frontend eq 'html') {
<iframe src="/<%= $city %>/<%= $stop %>.html?<%= $params %>" id="display"
height="<%= $height * 5 %>" width="<%= $width * 5 %>"></iframe>
% }
% elsif ($frontend eq 'json') {
<p>
<a href="/<%= $city %>/<%= $stop %>.json?<%= $params %>">JSON data for
<%= $city %> <%= $stop %></a>
</p>
<p>
Data is cached for 1 minute: JSON format:
</p>
<ul>
<li>error: err string if an error occured, otherwise null</li>
<li>preformatted: strings used by the PNG / HTML frontend</li>
<li>raw:
% if (param('backend') and param('backend') eq 'db') {
serialized
<a href="http://finalrewind.org/projects/Travel-Status-DE-DeutscheBahn/">
Travel::Status::DE::DeutscheBahn</a>-objects, see the
<a href="http://man.finalrewind.org/3/Travel-Status-DE-DeutscheBahn-Result/">::Result</a>
documentation
% }
% else {
serialized
<a href="http://finalrewind.org/projects/Travel-Status-DE-VRR/">
Travel::Status::DE::VRR</a>-objects, see the
<a href="http://man.finalrewind.org/3/Travel-Status-DE-VRR-Result/">::Result</a>
and
<a href="http://man.finalrewind.org/3/Travel-Status-DE-VRR-Line/">::Line</a>
documentation
% }
</li>
<li>version: Program version (string, not numeric)</li>
</ul>
% }
% } # ($city and $stop)
% else {

<p>
VRR-Fakedisplay shows the next departures at a public transit stop, just like
the Lumino LED displays used at some stops.
</p>

<p>
It works best for the VRR (Verkehrsverbund Rhein-Ruhr), but also supports most
other German transit networks.
</p>

% }

<div class="input-field">

% if (my $error = stash 'error') {
<p>
  Error: <%= $error %><br/>
</p>
% }

%= form_for _redirect => begin
<div>
  <div class="field">
    <div class="desc">City &rarr; Stop</div>
    <div>
      %= text_field 'city'
      %= text_field 'stop'
      %= submit_button 'Display'
    </div>
  </div>
  <div class="break"></div>
  <span class="optional">optional:</span>
  <div class="field">
    <div class="desc" title="number of lines">
      display height [1..10]</div>
    <div>
      %= text_field 'no_lines'
    </div>
  </div>
  <div class="field">
    <div class="desc">min. offset [minutes]</div>
    <div>
    %= text_field 'offset'
    </div>
  </div>
  <div class="field">
    <div class="desc" title="comma-separated list, example: NE,U,10">
      match line prefixes¹</div>
    <div>
      %= text_field 'line'
    </div>
  </div>
  <div class="field">
    <div class="desc" title="comma-separated list. Buggy.">match platform¹</div>
    <div>
      %= text_field 'platform'
    </div>
  </div>
  <div class="field">
    <div class="desc">backend</div>
    <div>
      %= select_field backend => [['EFA (VRR)' => 'vrr'], ['HAFAS (DB)' => 'db']]
    </div>
  </div>
  <div class="field">
    <div class="desc">frontend</div>
    <div>
      %= select_field frontend => [['Image (PNG)' => 'png'], ['HTML' => 'html'], ['JSON' => 'json']]
    </div>
  </div>
</div>
% end

<p>
<b>¹</b> separate values with commas, e.g. NE,U,10
</p>
</div> <!-- input-field -->

<div class="notes">
<span class="notes">notes:</span>
<ul>
<li>The EFA backend does not support Umlauts</li>
<li>For D&uuml;sseldorf, the DB backend usually gives better results</li>
<li>If you write the city correctly (like "Essen", not "essen"), vrr-fake can
shorten destination names</li>
<li><a href="/Essen/Martinstr?no_lines=8">Example</a>
</li>
</ul>
</div> <!-- notes -->

<div class="about">
<a href="http://finalrewind.org/projects/vrr-fakedisplay/">vrr-fakedisplay</a>
v<%= $version %>
</div>

%= javascript begin
function reloadDisplay() {
	d = new Date();
	$("#display").attr("src", "../<%= $city %>/<%= $stop %>.<%= $frontend %>?<%= $params %>&r="+d.getTime())
	setTimeout('reloadDisplay()', 60000);
}

setTimeout('reloadDisplay()', 60000);
% end

</body>


</html>
